package HW1.Problem3;

public class SupplierToProductAdapter {
    public Product adapt(CsvTable table, String[] row) {
        String cat = val(table, row, "Category", "ProductName");
        String name = val(table, row, "Name", "ProductName");
        double price = parsePrice(val(table, row, "Price"));
        String processor = val(table, row, "Processor");
        String ram = val(table, row, "RAM");
        String storage = val(table, row, "Storage");
        String graphics = val(table, row, "Integrated");
        String os = val(table, row, "Operating System");

        if (isLaptop(cat, name)) {
            return new Laptop(name, price, processor, ram, storage, graphics, os);
        } else if (isPhone(cat, name)) {
            String screen = val(table, row, "Screen");
            String camera = val(table, row, "Camera");
            String battery = val(table, row, "Battery");
            return new Smartphone(name, price, screen, processor, camera, battery, storage, os);
        }
        boolean looksLaptop = !graphics.isBlank() || !os.isBlank();
        if (looksLaptop) {
            return new Laptop(name, price, processor, ram, storage, graphics, os);
        }
        return new Smartphone(name, price, "", processor, "", "", storage, os);
    }

    private static String val(CsvTable t, String[] row, String... headerNames) {
        for (String h : headerNames) {
            int idx = t.indexOf(h);
            if (idx >= 0 && idx < row.length) {
                String v = row[idx];
                if (v != null && !v.isBlank()) return v.trim();
            }
        }
        return "";
    }

    private static boolean isLaptop(String cat, String name) {
        String s = (cat + " " + name).toLowerCase();
        return s.contains("laptop");
    }

    private static boolean isPhone(String cat, String name) {
        String s = (cat + " " + name).toLowerCase();
        return s.contains("phone") || s.contains("smartphone");
    }

    private static double parsePrice(String s) {
        if (s == null || s.isBlank()) return 0.0;
        try { return Double.parseDouble(s.replaceAll("[^0-9.]", "")); }
        catch (Exception e) { return 0.0; }
    }
}
